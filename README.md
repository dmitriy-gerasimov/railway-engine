# Railway Game Engine

### Requirements:
1. .NET Framework 4.6.1 (для Demo)
2. Platform Toolset Visual Studio 2019: v142
3. Windows SDK Version 10.0

### Описание структуры основного решения

**1. Engine.Dynamics (in work)**

В проекте реализуется расчет движения вагонов и поведение автосцепки

**2. Engine.Electric**

В проекте реализуется имитация электриких схем локомотива и вагонов

**3. Engine.Example**

В проекте реализуется тестовый игровой мир с графом и физикой, используется для демонстрации работы проекта

**4. Engine.Graph**

В проекте реализуется граф для имитации железной дороги

**5. Engine.Pneumatic**

В проекте реализуется имитация пневматических систем локомотива и вагонов

**6. Engine.Tests**

Проект с unit-тестами

### Описание структуры демонстрационного проекта

**1. Engine.Demo.Infrastructure**

Проект содержит инфраструктуру игрового цикла

**2. Engine.Demo.Integration**

C++/CLI проект для интеграции С++ с DotNet проектом

**3. Engine.Demo.Shell**

WPF проект для визуальной демонстрации работы пневматики и динамики

### Pneumatic Naming convention

1. Переменные с названиями вида `a_x_y`:
   * `1` - если открыто соединение между резервуарами **x** и **y**
   * `0` - если закрыто соединение между резервуарами **x** и **y**
2. Переменные с названиями вида `r_x_y`: коэффициент, влияющий на скорость перетекания воздуха между резервуарами **x** и **y**
3. Названия резервуаров
    * `tm` - тормозная магистраль
    * `pm` - питательная магистраль
    * `mvt` - магистраль вспомогательного тормоза
    * `im` - импульсная магистраль
    * `gr` - главный резервуар
    * `up` - полость над уравнительным поршнем
    * `ur` - уравнительный резервуар
    * `mk` - магистральная камера
    * `rk` - рабочая камера
    * `zk` - золотниковая камера
    * `zr` - запасной резервуар
    * `kdr` - камера дополнительной разрядки
    * `psk` - полость над срывным клапаном (ЭПК150)
    * `kvv` - камера выдержки времени (ЭПК150)
    * `np, vp, dk` - это резервуары внутри крана 254

4. Кроме того есть переменные вида `a_x_y` и `r_x_y` c постфиксом
    * `_stb` - стабилизатор
    * `_por` - поршень
    * `_red` - редуктор

5. Переменные вида `Vx` - объём резервуара **x** 
6. Переменные вида `px` - давление в резервуаре **x**
7. Переменные вида `px0` - давление в резервуаре **x** на предыдущем шаге (в предыдущем кадре)

#### Примеры
1. `a_pm_tm`:
   * `1` - если открыто соединение между ПМ и ТМ
   * `0` - если закрыто соединение между ПМ и ТМ
2. `r_pm_tm`: коэффициент, влияющий на скорость перетекания воздуха между ПМ и ТМ
3. `r_pm_tm_por`: коэффициент, влияющий на скорость перетекания воздуха между ПМ и ТМ через поршень (уравнительный поршень)
4. `a_pm_up_stb`:
   * `1` - если **открыто** соединение между ПМ и УП через стабилизатор 
   * `0` - если **закрыто** соединение между ПМ и УП через стабилизатор 
5. `Vgr` - объем в ГР
6. `pup` - давление в УП
7. `ptm0` - давление в ТМ на предыдущем шаге (в предыдущем кадре)

### Описание структуры проекта Engine.Dynamics

1. Класс Dynamic содержит расчёт движения одного вагона с учётом сил, возникающих на сцепках.
	Для его работы необходимо задать следующие параметры
	- масса вагона (Dynamic::setMass(double a_mass))
	- параметры сцепки (Dynamic::setCouplingParameters(double k, double r, double freeWheelAmount))
	
	В каждом кадре задавать
	- текущую силу тяги (Dynamic::setTractionForce(double a_force))
	- текущую силу торможения (Dynamic::setBrakeForce(double a_force))
	- текущий уклон (Dynamic::setGradient(double a_gradient))
	
	Расчёт параметров движения: ускорения, скорости и смещения за текущий кадр - происходит в функции Dynamic::update(double a_deltaSeconds),
	которую необходимо вызывать каждый кадр.
	
	Для корректировки силы трения (при движении накатом) необходимо вызывать функцию Dynamic::setFrictionForceFactor(double a_factor)

2. Класс Coupling расчёт сил, возникающих на сцепках.
	Для его работы необходимо
	- задать параметры сцепки (Coupling::setCouplingParameters(double k, double r, double freeWheelAmount))
	- задать массу вагона (Coupling::setMass(double a_mass))
	- задать соседнюю сцепку (Coupling::setConnectedCoupling(Coupling* a_coupling))
	
	В каждом кадре задавать
	- текущую 3D координату (Coupling::setWorldLocation(Vector3D a_location))
	- текущую скорость (Coupling::setVelocity(double a_velocity))

	Расчёт силы, возникающей на сцепке происходит в функции Coupling::update(double a_deltaSeconds),
	которую необходимо вызывать каждый кадр.